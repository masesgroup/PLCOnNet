<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>Usage PLC4X suite for .NET | MASES Group - PLC4Net </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Usage PLC4X suite for .NET | MASES Group - PLC4Net ">
      <meta name="description" content="Describes how to use PLC4Net, set-up environment, identify the JVM and write good code">
      
      <link rel="icon" href="../images/favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/masesgroup/PLC4Net/blob/master/src/documentation/articles/usage.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../images/logo.png" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="plc4net-usage">PLC4Net usage</h1>

<p>To use PLC4Net classes the developer can write code in .NET using the same classes available in the official Java packages.
If classes or methods are not available yet it is possible to use the approach synthetized in <a href="https://jnet.masesgroup.com/articles/API_extensibility.html">What to do if an API was not yet implemented</a></p>
<p>The following code snippets and examples are mutuated from <a href="https://plc4x.apache.org/plc4x/latest/users/getting-started/plc4j.html">PLC4X official website</a></p>
<h2 id="read-data-from-plc">Read data from PLC</h2>
<p>The following code connects to a Siemens PLC using the <em>s7</em> protocol and requests to read some tags:</p>
<pre><code class="lang-C#">
const string connectionString = &quot;s7://10.10.64.20&quot;;

using var plcConnection = PlcDriverManager.Default.ConnectionManager.GetConnection(connectionString);

if (!plcConnection.Metadata.IsReadSupported())
{
    Console.WriteLine(&quot;This connection doesn't support reading.&quot;);
    return;
}
// Create a new read request:
// - Give the single item requested an alias name
PlcReadRequest.Builder builder = plcConnection.ReadRequestBuilder();
builder.AddTagAddress(&quot;value-1&quot;, &quot;%Q0.4:BOOL&quot;);
builder.AddTagAddress(&quot;value-2&quot;, &quot;%Q0:BYTE&quot;);
builder.AddTagAddress(&quot;value-3&quot;, &quot;%I0.2:BOOL&quot;);
builder.AddTagAddress(&quot;value-4&quot;, &quot;%DB.DB1.4:INT&quot;);
PlcRequest readRequest = builder.Build();

var cf = readRequest.Execute&lt;PlcReadResponse&gt;();
var response = cf.Get();

foreach (Java.Lang.String tagName in response.TagNames)
{
    if (response.GetResponseCode(tagName) == PlcResponseCode.OK)
    {
        int numValues = response.GetNumberOfValues(tagName);
        // If it's just one element, output just one single line.
        if (numValues == 1)
        {
            Console.WriteLine($&quot;Value[{tagName}]: {response.GetObject(tagName)}&quot;);
        }
        // If it's more than one element, output each in a single row.
        else
        {
            Console.WriteLine($&quot;Value[{tagName}]:&quot;);
            for (int i = 0; i &lt; numValues; i++)
            {
                Console.WriteLine($&quot; - {response.GetObject(tagName, i)}&quot;);
            }
        }
    }
    // Something went wrong, to output an error message instead.
    else
    {
        Console.WriteLine($&quot;Error[{tagName}]: {response.GetResponseCode(tagName).Name()}&quot;);
    }
}

</code></pre>
<h2 id="write-data-to-plc">Write data to PLC</h2>
<p>The following code connects to a Siemens PLC using the <em>s7</em> protocol and requests to write some tags:</p>
<pre><code class="lang-C#">
const string connectionString = &quot;s7://10.10.64.20&quot;;

using var plcConnection = PlcDriverManager.Default.ConnectionManager.GetConnection(connectionString);

if (!plcConnection.Metadata.IsWriteSupported())
{
    Console.WriteLine(&quot;This connection doesn't support writing.&quot;);
    return;
}
// Create a new write request:
// - Give the single item requested an alias name
// - Pass in the data you want to write (for arrays, pass in one value for every element)
PlcWriteRequest.Builder builder = plcConnection.WriteRequestBuilder();
builder.AddTagAddress(&quot;value-1&quot;, &quot;%Q0.4:BOOL&quot;, true);
builder.AddTagAddress(&quot;value-2&quot;, &quot;%Q0:BYTE&quot;, (byte)0xFF);
builder.AddTagAddress(&quot;value-4&quot;, &quot;%DB.DB1.4:INT[3]&quot;, 7, 23, 42);
PlcRequest writeRequest = builder.Build();

var cf = writeRequest.Execute&lt;PlcWriteResponse&gt;();
var response = cf.Get();

foreach (Java.Lang.String tagName in response.TagNames)
{
    if (response.GetResponseCode(tagName) == PlcResponseCode.OK)
    {
        Console.WriteLine($&quot;Value[{tagName}]: updated&quot;);
    }
    // Something went wrong, to output an error message instead.
    else
    {
        Console.WriteLine($&quot;Error[{tagName}]: {response.GetResponseCode(tagName).Name()}&quot;);
    }
}

</code></pre>
<h2 id="subscribe-to-plc">Subscribe to PLC</h2>
<p>The following code connects to a Siemens PLC using the <em>s7</em> protocol and subscribe to data change of some tags:</p>
<pre><code class="lang-C#">
ConcurrentDictionary&lt;int, PlcConsumerRegistration&gt; _registrationMap = new();
Consumer&lt;PlcSubscriptionEvent&gt; _plcEvent = null;
const string connectionString = &quot;s7://10.10.64.20&quot;;

using var plcConnection = PlcDriverManager.Default.ConnectionManager.GetConnection(connectionString);

if (!plcConnection.Metadata.IsSubscribeSupported())
{
    Console.WriteLine(&quot;This connection doesn't support subscribing.&quot;);
    return;
}
// Create a new subscription request:
// - Give the single tag requested an alias name
PlcSubscriptionRequest.Builder builder = plcConnection.SubscriptionRequestBuilder();
builder.AddChangeOfStateTagAddress(&quot;value-1&quot;, &quot;{some address}&quot;);
builder.AddCyclicTagAddress(&quot;value-2&quot;, &quot;{some address}&quot;, Duration.OfMillis(1000));
builder.AddEventTagAddress(&quot;value-3&quot;, &quot;{some alarm address}&quot;);
PlcRequest subscriptionRequest = builder.Build();

var cf = subscriptionRequest.Execute&lt;PlcSubscriptionResponse&gt;();
var response = cf.Get();

_plcEvent ??= new Consumer&lt;PlcSubscriptionEvent&gt;()
{
    OnAccept = (e) =&gt;
    {
        foreach (Java.Lang.String tagName in e.TagNames)
        {
            Console.WriteLine(e.GetPlcValue(tagName));
        }
    }
};

foreach (PlcSubscriptionHandle subscriptionHandle in response.SubscriptionHandles)
{
    var reg = subscriptionHandle.Register(_plcEvent);
    _registrationMap.GetOrAdd(reg.ConsumerId, (_) =&gt; reg); 
}

// wait many events then cleanup

foreach (var item in _registrationMap)
{
    item.Value.Unregister();
}

</code></pre>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/masesgroup/PLC4Net/blob/master/src/documentation/articles/usage.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <script type="text/javascript">document.write('<div style="text-align: center;">Copyright © 2024 - ' + new Date().getFullYear() + ' MASES s.r.l. | Via San Cesidio 16 - San Valentino in A.C. - PE | P.I. 01932310681</div>');</script>
        </div>
      </div>
    </footer>
  </body>
</html>
